<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Family Feast Grimoire</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg: #f5efe6;
      --bg-card: #fffaf2;
      --border: #d3c3a3;
      --accent: #8b5e3c;
      --accent-soft: #c19a6b;
      --text: #2c241a;
      --muted: #7a6b55;
      --danger: #b33939;
      --success: #3c8b5e;
      --radius: 12px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #fdf7ec, #f5efe6);
      color: var(--text);
    }
    #app {
      max-width: 900px;
      margin: 0 auto;
      padding: 12px 12px 64px;
    }
    header { text-align: center; padding: 8px 0 12px; }
    header h1 { margin: 0; font-size: 1.6rem; letter-spacing: 0.05em; }
    header p { margin: 4px 0 0; font-size: 0.85rem; color: var(--muted); }
    .nav-bar {
      display: flex; gap: 8px; margin: 12px 0; overflow-x: auto; padding-bottom: 4px;
    }
    .nav-btn {
      flex: 1; min-width: 0; border: 1px solid var(--border);
      background: #fdf7ec; border-radius: 999px; padding: 8px;
      font-size: 0.8rem; text-align: center; cursor: pointer; white-space: nowrap;
    }
    .nav-btn.active {
      background: var(--accent); color: #fffaf2; border-color: var(--accent); font-weight: 600;
    }
    main { margin-top: 4px; }
    .card {
      background: var(--bg-card); border-radius: var(--radius); padding: 12px;
      margin-bottom: 10px; border: 1px solid var(--border);
      box-shadow: 0 2px 4px rgba(0,0,0,0.04);
    }
    .card-header { display: flex; justify-content: space-between; align-items: baseline; gap: 8px; }
    .card-title { font-size: 1rem; font-weight: 600; }
    .chip { display: inline-block; padding: 2px 6px; border-radius: 999px; border: 1px solid var(--border);
      font-size: 0.7rem; margin: 2px 4px 0 0; background: #fdf3dd; }
    .chip.protein { background: #f8efe0; border-color: var(--accent-soft); }
    .chip.archived { background: #f7d7d7; border-color: var(--danger); color: var(--danger); }
    .muted { font-size: 0.75rem; color: var(--muted); }
    .stars { font-size: 0.85rem; color: #f1b70f; white-space: nowrap; }
    .btn {
      display: inline-flex; align-items: center; justify-content: center; padding: 6px 10px;
      border-radius: 999px; border: 1px solid var(--border); background: #fdf7ec;
      font-size: 0.8rem; cursor: pointer; gap: 4px;
    }
    .btn.primary { background: var(--accent); border-color: var(--accent); color: #fffaf2; }
    .btn.danger { border-color: var(--danger); color: var(--danger); background: #fff5f5; }
    .btn.success { border-color: var(--success); color: var(--success); background: #f3fff7; }
    .btn.small { padding: 4px 8px; font-size: 0.75rem; }
    .btn-block { width: 100%; justify-content: center; }
    .toolbar { display: flex; gap: 8px; margin-bottom: 8px; flex-wrap: wrap; }
    .toolbar input, .toolbar select { flex: 1; min-width: 120px; }
    input[type="text"], input[type="number"], textarea, select {
      width: 100%; padding: 6px 8px; border-radius: 8px; border: 1px solid var(--border);
      font-size: 0.85rem; background: #fffcf6;
    }
    textarea { min-height: 70px; resize: vertical; }
    label { font-size: 0.8rem; display: block; margin-bottom: 3px; color: var(--muted); }
    .field { margin-bottom: 8px; }
    .field-row { display: flex; gap: 6px; }
    .section-title { font-size: 0.9rem; font-weight: 600; margin: 8px 0 4px; }
    ul { padding-left: 20px; margin: 4px 0; }
    .inline-checkboxes { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 4px; }
    .inline-checkboxes label { display: inline-flex; align-items: center; gap: 4px;
      border-radius: 999px; border: 1px solid var(--border); padding: 3px 8px;
      background: #fffaf2; cursor: pointer;
    }
    .badge { display: inline-block; border-radius: 999px; padding: 2px 6px; font-size: 0.7rem;
      background: #eee2c8; margin-right: 4px;
    }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 8px; }
    .stat-card { background: var(--bg-card); border-radius: var(--radius); border: 1px solid var(--border);
      padding: 10px; font-size: 0.8rem; }
    .stat-card h3 { margin: 0 0 4px; font-size: 0.9rem; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div id="app">
    <header>
      <h1>Family Feast Grimoire</h1>
      <p>Track the spells (meals) your party loves.</p>
    </header>
    <div class="nav-bar">
      <button class="nav-btn active" data-view="spellbook-view">üìú Spellbook</button>
      <button class="nav-btn" data-view="feast-form-view" data-mode="create">‚ûï Add Feast</button>
      <button class="nav-btn" data-view="party-view">üßô Party Members</button>
      <button class="nav-btn" data-view="stats-view">üìä Stats</button>
      <button class="nav-btn" data-view="help-view">‚ùî How to Use</button>
    </div>
    <main>
      <section id="spellbook-view"><div id="spellbook-list"></div></section>
      <section id="feast-detail-view" class="hidden"></section>
      <section id="feast-form-view" class="hidden"><div class="card"><form id="feast-form"></form></div></section>
      <section id="party-view" class="hidden"></section>
      <section id="stats-view" class="hidden"><div class="card"><div id="stats-content"></div></div></section>
      <section id="help-view" class="hidden"><div class="card"><p class="muted">Help coming soon.</p></div></section>
    </main>
  </div>

  <script type="module">
  // --- üî• FIREBASE CONNECTION SETUP (for shared Family Feast Grimoire) ---
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAw6pqDHCb9FGYf735gQMg6NUZm9nJNluM",
    authDomain: "family-feast-grimoire.firebaseapp.com",
    projectId: "family-feast-grimoire",
    storageBucket: "family-feast-grimoire.firebasestorage.app",
    messagingSenderId: "38369726039",
    appId: "1:38369726039:web:9584edb6eaa2727e221d12",
    measurementId: "G-LC4R1Y3313"
  };
  const fbApp = initializeApp(firebaseConfig);
  const db = getFirestore(fbApp);
  // --- END FIREBASE SETUP ---

  const STORAGE_KEY = 'familyFeastGrimoire';

  function defaultData() {
    return { partyMembers: ['Mom','Dad','Andrew','Nathan'], feasts: [] };
  }

  function loadState() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) return defaultData();
      return JSON.parse(raw);
    } catch(e) { return defaultData(); }
  }

  let state = loadState();

  async function syncToCloud() {
    try {
      const ref = doc(db, "grimoire", "appState");
      await setDoc(ref, state);
    } catch(e) { console.error("Cloud sync failed", e); }
  }

  async function syncFromCloud() {
    try {
      const ref = doc(db, "grimoire", "appState");
      const snap = await getDoc(ref);
      if (snap.exists()) {
        state = snap.data();
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      } else { await syncToCloud(); }
    } catch(e) { console.error("Cloud load failed", e); }
  }

  function saveState() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    syncToCloud();
  }

  function renderSpellbook() {
    const el = document.getElementById('spellbook-list');
    el.innerHTML = '';
    if (!state.feasts.length) {
      el.innerHTML = '<p class="muted">No feasts yet. Add one soon!</p>';
      return;
    }
    state.feasts.forEach(f => {
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `<div class="card-title">${f.name}</div><div class="muted">${f.protein || ''}</div>`;
      el.appendChild(card);
    });
  }

  async function initApp() {
    renderSpellbook();
    await syncFromCloud();
    renderSpellbook();
  }

  initApp();
  </script>
</body>
</html>
